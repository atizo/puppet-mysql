#!/bin/sh

test $# -gt 0 || exit 1

/etc/init.d/mysqld stop
/usr/libexec/mysqld --skip-grant-tables --user=root \
                    --datadir=/var/lib/mysql/data \
                    --log-bin=/var/lib/mysql/mysql-bin &
sleep 5

echo "UPDATE user SET Password=PASSWORD('$1') 
      WHERE User='root' AND Host='localhost';" \
| mysql -u root mysql

killall mysqld
chown -R mysql:mysql /var/lib/mysql
/etc/init.d/service mysqld start
